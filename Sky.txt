local cloneref = cloneref or function(obj) return obj end
local RunService = cloneref(game:GetService("RunService"))
local UserInputService = cloneref(game:GetService("UserInputService"))
local TweenService = cloneref(game:GetService("TweenService"))
local HttpService = cloneref(game:GetService("HttpService"))
local Players = cloneref(game:GetService("Players"))
local LocalPlayer = Players.LocalPlayer
local CoreGui = cloneref(game:GetService("CoreGui"))

local Sky = {
    Toggled = false,
    Configs = {},
    CurrentConfig = "default",
    Theme = "Dark",
    Colors = {
        Primary = Color3.fromRGB(173, 216, 230), -- 淡蓝色
        Background = Color3.fromRGB(25, 25, 35),
        Text = Color3.fromRGB(240, 240, 240),
        Accent = Color3.fromRGB(100, 150, 255),
        Success = Color3.fromRGB(76, 175, 80),
        Warning = Color3.fromRGB(255, 152, 0),
        Error = Color3.fromRGB(244, 67, 54)
    },
    Icons = {},
    Windows = {},
    Keybinds = {},
    Signals = {},
    Font = "rbxassetid://12187365364",
    CornerRadius = 8,
    Transparency = 0.2,
    MinSize = Vector2.new(480, 360),
    DPIScale = 1
}

-- 创建透明磨砂玻璃效果
local function createFrostedGlass(frame)
    local blur = Instance.new("BlurEffect")
    blur.Size = 8
    blur.Name = "SkyUIFrostEffect"
    blur.Parent = frame
    
    local gradient = Instance.new("UIGradient")
    gradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, Sky.Transparency),
        NumberSequenceKeypoint.new(1, Sky.Transparency + 0.3)
    })
    gradient.Rotation = 90
    gradient.Name = "SkyUIGradient"
    gradient.Parent = frame
    
    return blur, gradient
end

-- 初始化图标系统
function Sky.InitIcons()
    local iconUrl = "https://raw.githubusercontent.com/Footagesus/Icons/main/Main-v2.lua"
    local success, icons = pcall(function()
        return loadstring(game:HttpGet(iconUrl))()
    end)
    
    if success and icons then
        Sky.Icons = icons
        Sky.Icons.SetIconsType("lucide")
    else
        -- 内置备用图标
        Sky.Icons = {
            Close = "rbxassetid://10734872306",
            Save = "rbxassetid://10734878421",
            Load = "rbxassetid://10734875897",
            Menu = "rbxassetid://10734877342",
            Settings = "rbxassetid://10734880055",
            Check = "rbxassetid://10734871121"
        }
    end
end

-- 创建圆角框架
function Sky.CreateRoundedFrame(parent, size, position, radius, color, transparency)
    radius = radius or Sky.CornerRadius
    local frame = Instance.new("Frame")
    frame.BackgroundColor3 = color or Sky.Colors.Background
    frame.BackgroundTransparency = transparency or Sky.Transparency
    frame.Size = size
    frame.Position = position
    frame.ClipsDescendants = true
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius)
    corner.Parent = frame
    
    -- 添加磨砂玻璃效果
    createFrostedGlass(frame)
    
    if parent then
        frame.Parent = parent
    end
    
    return frame
end

-- 创建文本标签
function Sky.CreateLabel(parent, text, size, position, options)
    options = options or {}
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = size
    label.Position = position
    label.BackgroundTransparency = 1
    label.TextColor3 = options.TextColor or Sky.Colors.Text
    label.Font = options.Font or Enum.Font.Gotham
    label.TextSize = options.TextSize or 14
    label.TextXAlignment = options.XAlignment or Enum.TextXAlignment.Left
    label.TextYAlignment = options.YAlignment or Enum.TextYAlignment.Center
    label.TextWrapped = options.Wrapped or false
    label.RichText = true
    
    -- 添加阴影提高可读性
    local shadow = Instance.new("UIStroke")
    shadow.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    shadow.Thickness = 1
    shadow.Color = Color3.new(0, 0, 0)
    shadow.Transparency = 0.5
    shadow.Parent = label
    
    if parent then
        label.Parent = parent
    end
    
    return label
end

-- 创建按钮
function Sky.CreateButton(parent, text, size, position, callback)
    local button = Instance.new("TextButton")
    button.Text = text
    button.Size = size
    button.Position = position
    button.BackgroundColor3 = Sky.Colors.Primary
    button.BackgroundTransparency = 0.2
    button.AutoButtonColor = false
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.GothamSemibold
    button.TextSize = 14
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, Sky.CornerRadius)
    corner.Parent = button
    
    -- 悬停效果
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {
            BackgroundTransparency = 0.1,
            TextColor3 = Color3.new(1, 1, 1)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {
            BackgroundTransparency = 0.2,
            TextColor3 = Color3.new(1, 1, 1)
        }):Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0,
            Size = size - UDim2.new(0, 4, 0, 4)
        }):Play()
        wait(0.1)
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.2,
            Size = size
        }):Play()
        
        if callback then
            callback()
        end
    end)
    
    if parent then
        button.Parent = parent
    end
    
    return button
end

-- 创建开关
function Sky.CreateToggle(parent, text, default, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1, 0, 0, 30)
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Parent = parent
    
    local label = Sky.CreateLabel(toggleFrame, text, UDim2.new(0.7, 0, 1, 0), UDim2.new(0, 0, 0, 0))
    
    local toggleButton = Instance.new("Frame")
    toggleButton.Size = UDim2.new(0.25, 0, 0, 24)
    toggleButton.Position = UDim2.new(0.75, 0, 0, 3)
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    toggleButton.BackgroundTransparency = 0.5
    toggleButton.Parent = toggleFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = toggleButton
    
    local toggleSwitch = Instance.new("Frame")
    toggleSwitch.Size = UDim2.new(0, 20, 0, 20)
    toggleSwitch.Position = UDim2.new(0, 2, 0, 2)
    toggleSwitch.BackgroundColor3 = Sky.Colors.Primary
    toggleSwitch.BackgroundTransparency = 0
    toggleSwitch.Parent = toggleButton
    
    local switchCorner = Instance.new("UICorner")
    switchCorner.CornerRadius = UDim.new(0, 10)
    switchCorner.Parent = toggleSwitch
    
    local state = default or false
    
    local function updateToggle()
        if state then
            TweenService:Create(toggleSwitch, TweenInfo.new(0.15), {
                Position = UDim2.new(1, -22, 0, 2),
                BackgroundColor3 = Sky.Colors.Success
            }):Play()
        else
            TweenService:Create(toggleSwitch, TweenInfo.new(0.15), {
                Position = UDim2.new(0, 2, 0, 2),
                BackgroundColor3 = Sky.Colors.Primary
            }):Play()
        end
    end
    
    updateToggle()
    
    toggleButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            state = not state
            updateToggle()
            if callback then callback(state) end
        end
    end)
    
    return {
        SetState = function(newState)
            state = newState
            updateToggle()
        end,
        GetState = function() return state end
    }
end

-- 创建滑块
function Sky.CreateSlider(parent, text, min, max, default, callback)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, 0, 0, 50)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = parent
    
    local label = Sky.CreateLabel(sliderFrame, text, UDim2.new(1, 0, 0, 20), UDim2.new(0, 0, 0, 0))
    
    local track = Instance.new("Frame")
    track.Size = UDim2.new(1, 0, 0, 6)
    track.Position = UDim2.new(0, 0, 0, 30)
    track.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    track.BackgroundTransparency = 0.5
    track.Parent = sliderFrame
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 3)
    trackCorner.Parent = track
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(0, 0, 1, 0)
    fill.BackgroundColor3 = Sky.Colors.Primary
    fill.BackgroundTransparency = 0.2
    fill.Parent = track
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 3)
    fillCorner.Parent = fill
    
    local thumb = Instance.new("Frame")
    thumb.Size = UDim2.new(0, 16, 0, 16)
    thumb.Position = UDim2.new(0, 0, 0.5, -8)
    thumb.BackgroundColor3 = Sky.Colors.Accent
    thumb.Parent = track
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(0, 8)
    thumbCorner.Parent = thumb
    
    local valueLabel = Sky.CreateLabel(sliderFrame, tostring(default), UDim2.new(0, 50, 0, 20), 
                                      UDim2.new(1, -50, 0, 0))
    
    local currentValue = default or min
    local isDragging = false
    
    local function updateSlider(value)
        currentValue = math.clamp(value, min, max)
        local ratio = (currentValue - min) / (max - min)
        fill.Size = UDim2.new(ratio, 0, 1, 0)
        thumb.Position = UDim2.new(ratio, -8, 0.5, -8)
        valueLabel.Text = tostring(math.floor(currentValue))
        
        if callback then callback(currentValue) end
    end
    
    updateSlider(currentValue)
    
    local function onInput(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = true
        end
    end
    
    track.InputBegan:Connect(onInput)
    
    local function onDrag(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local posX = input.Position.X - track.AbsolutePosition.X
            local ratio = math.clamp(posX / track.AbsoluteSize.X, 0, 1)
            updateSlider(min + ratio * (max - min))
        end
    end
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            onDrag(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)
    
    return {
        SetValue = updateSlider,
        GetValue = function() return currentValue end
    }
end

-- 创建下拉菜单
function Sky.CreateDropdown(parent, text, options, default, callback)
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(1, 0, 0, 30)
    dropdownFrame.BackgroundTransparency = 1
    dropdownFrame.Parent = parent
    
    local label = Sky.CreateLabel(dropdownFrame, text, UDim2.new(0.7, 0, 1, 0), UDim2.new(0, 0, 0, 0))
    
    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Size = UDim2.new(0.25, 0, 0, 24)
    dropdownButton.Position = UDim2.new(0.75, 0, 0, 3)
    dropdownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    dropdownButton.BackgroundTransparency = 0.5
    dropdownButton.Text = default or "Select"
    dropdownButton.TextColor3 = Sky.Colors.Text
    dropdownButton.Font = Enum.Font.Gotham
    dropdownButton.TextSize = 12
    dropdownButton.Parent = dropdownFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 4)
    corner.Parent = dropdownButton
    
    local dropdownList = Instance.new("ScrollingFrame")
    dropdownList.Size = UDim2.new(0.25, 0, 0, 0)
    dropdownList.Position = UDim2.new(0.75, 0, 0, 27)
    dropdownList.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    dropdownList.BackgroundTransparency = 0.1
    dropdownList.BorderSizePixel = 0
    dropdownList.Visible = false
    dropdownList.CanvasSize = UDim2.new(0, 0, 0, 0)
    dropdownList.ScrollBarThickness = 4
    dropdownList.Parent = dropdownFrame
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Parent = dropdownList
    
    local isOpen = false
    
    local function updateList()
        dropdownList.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
    end
    
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateList)
    
    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Size = UDim2.new(1, 0, 0, 25)
        optionButton.BackgroundTransparency = 1
        optionButton.Text = option
        optionButton.TextColor3 = Sky.Colors.Text
        optionButton.Font = Enum.Font.Gotham
        optionButton.TextSize = 12
        optionButton.TextXAlignment = Enum.TextXAlignment.Left
        optionButton.Parent = dropdownList
        
        optionButton.MouseButton1Click:Connect(function()
            dropdownButton.Text = option
            isOpen = false
            dropdownList.Visible = false
            if callback then callback(option) end
        end)
        
        optionButton.MouseEnter:Connect(function()
            optionButton.BackgroundTransparency = 0.8
        end)
        
        optionButton.MouseLeave:Connect(function()
            optionButton.BackgroundTransparency = 1
        end)
    end
    
    dropdownButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        dropdownList.Visible = isOpen
        if isOpen then
            dropdownList.Size = UDim2.new(0.25, 0, 0, math.min(150, listLayout.AbsoluteContentSize.Y))
        end
    end)
    
    return {
        SetSelected = function(value)
            dropdownButton.Text = value
        end,
        GetSelected = function() return dropdownButton.Text end
    }
end

-- 创建快捷菜单
function Sky.CreateQuickMenu()
    local menu = Instance.new("Frame")
    menu.Size = UDim2.new(0, 180, 0, 0)
    menu.BackgroundColor3 = Sky.Colors.Background
    menu.BackgroundTransparency = Sky.Transparency
    menu.Visible = false
    menu.ZIndex = 100
    menu.Parent = CoreGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, Sky.CornerRadius)
    corner.Parent = menu
    
    createFrostedGlass(menu)
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Parent = menu
    
    local function updateSize()
        menu.Size = UDim2.new(0, 180, 0, listLayout.AbsoluteContentSize.Y)
    end
    
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateSize)
    
    local menuItems = {}
    
    function menuItems.AddButton(text, icon, callback)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 35)
        button.BackgroundTransparency = 1
        button.Text = "   " .. text
        button.TextColor3 = Sky.Colors.Text
        button.Font = Enum.Font.Gotham
        button.TextSize = 14
        button.TextXAlignment = Enum.TextXAlignment.Left
        button.Parent = menu
        
        if icon then
            local iconImage = Instance.new("ImageLabel")
            iconImage.Size = UDim2.new(0, 20, 0, 20)
            iconImage.Position = UDim2.new(1, -30, 0.5, -10)
            iconImage.BackgroundTransparency = 1
            iconImage.Image = icon
            iconImage.Parent = button
        end
        
        button.MouseButton1Click:Connect(function()
            if callback then callback() end
            menu.Visible = false
        end)
        
        button.MouseEnter:Connect(function()
            button.BackgroundTransparency = 0.8
        end)
        
        button.MouseLeave:Connect(function()
            button.BackgroundTransparency = 1
        end)
        
        return button
    end
    
    function menuItems.AddSeparator()
        local separator = Instance.new("Frame")
        separator.Size = UDim2.new(1, -10, 0, 1)
        separator.Position = UDim2.new(0, 5, 0, 0)
        separator.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
        separator.BackgroundTransparency = 0.7
        separator.Parent = menu
    end
    
    function menuItems.Show(position)
        menu.Position = UDim2.new(0, position.X, 0, position.Y)
        menu.Visible = true
    end
    
    function menuItems.Hide()
        menu.Visible = false
    end
    
    -- 全局快捷菜单快捷键
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.RightControl then
            local mousePos = UserInputService:GetMouseLocation()
            menuItems.Show(UDim2.new(0, mousePos.X, 0, mousePos.Y))
        end
    end)
    
    return menuItems
end

-- 配置管理
function Sky.SaveConfig(name)
    name = name or Sky.CurrentConfig
    Sky.Configs[name] = {}
    
    -- 保存所有窗口状态
    for windowName, window in pairs(Sky.Windows) do
        Sky.Configs[name][windowName] = {
            Position = window.Position,
            Size = window.Size,
            Tabs = {}
        }
        
        -- 保存每个标签页的状态
        for tabName, tab in pairs(window.Tabs) do
            Sky.Configs[name][windowName].Tabs[tabName] = {
                Elements = {}
            }
            
            -- 保存元素状态
            for elementName, element in pairs(tab.Elements) do
                if element.GetState then
                    Sky.Configs[name][windowName].Tabs[tabName].Elements[elementName] = element.GetState()
                elseif element.GetValue then
                    Sky.Configs[name][windowName].Tabs[tabName].Elements[elementName] = element.GetValue()
                elseif element.GetSelected then
                    Sky.Configs[name][windowName].Tabs[tabName].Elements[elementName] = element.GetSelected()
                end
            end
        end
    end
end

function Sky.LoadConfig(name)
    name = name or Sky.CurrentConfig
    local config = Sky.Configs[name]
    if not config then return false end
    
    for windowName, windowData in pairs(config) do
        local window = Sky.Windows[windowName]
        if window then
            window.Position = windowData.Position
            window.Size = windowData.Size
            
            for tabName, tabData in pairs(windowData.Tabs) do
                local tab = window.Tabs[tabName]
                if tab then
                    for elementName, value in pairs(tabData.Elements) do
                        local element = tab.Elements[elementName]
                        if element then
                            if element.SetState then
                                element.SetState(value)
                            elseif element.SetValue then
                                element.SetValue(value)
                            elseif element.SetSelected then
                                element.SetSelected(value)
                            end
                        end
                    end
                end
            end
        end
    end
    
    return true
end

function Sky.DeleteConfig(name)
    Sky.Configs[name] = nil
    if Sky.CurrentConfig == name then
        Sky.CurrentConfig = "default"
    end
end

-- 创建通知
function Sky.Notify(title, content, duration, icon)
    duration = duration or 5
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0, 300, 0, 0)
    notification.Position = UDim2.new(1, -320, 1, -80)
    notification.BackgroundColor3 = Sky.Colors.Background
    notification.BackgroundTransparency = Sky.Transparency
    notification.ClipsDescendants = true
    notification.Parent = CoreGui
    notification.ZIndex = 50
    
    createFrostedGlass(notification)
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, Sky.CornerRadius)
    corner.Parent = notification
    
    local titleLabel = Sky.CreateLabel(notification, title, UDim2.new(1, -40, 0, 25), UDim2.new(0, 10, 0, 10))
    titleLabel.Font = Enum.Font.GothamSemibold
    titleLabel.TextSize = 16
    
    local contentLabel = Sky.CreateLabel(notification, content, UDim2.new(1, -20, 0, 40), 
                                        UDim2.new(0, 10, 0, 35))
    contentLabel.TextWrapped = true
    contentLabel.TextSize = 14
    
    if icon then
        local iconImage = Instance.new("ImageLabel")
        iconImage.Size = UDim2.new(0, 24, 0, 24)
        iconImage.Position = UDim2.new(1, -30, 0, 12)
        iconImage.BackgroundTransparency = 1
        iconImage.Image = icon
        iconImage.Parent = notification
    end
    
    TweenService:Create(notification, TweenInfo.new(0.3), {
        Size = UDim2.new(0, 300, 0, 85)
    }):Play()
    
    delay(duration, function()
        TweenService:Create(notification, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 300, 0, 0)
        }):Play()
        wait(0.3)
        notification:Destroy()
    end)
end

-- 创建主窗口
function Sky.CreateWindow(title, size, position, options)
    options = options or {}
    local window = {
        Tabs = {},
        Elements = {}
    }
    
    local windowFrame = Sky.CreateRoundedFrame(CoreGui, size, position, 12, nil, 0.1)
    windowFrame.ZIndex = 10
    
    -- 标题栏
    local titleBar = Sky.CreateRoundedFrame(windowFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), 0, nil, 0.05)
    titleBar.ZIndex = 11
    
    local titleLabel = Sky.CreateLabel(titleBar, title, UDim2.new(0.7, 0, 1, 0), UDim2.new(0, 15, 0, 0), {
        Font = Enum.Font.GothamBold,
        TextSize = 18
    })
    titleLabel.ZIndex = 12
    
    -- 关闭按钮
    local closeButton = Instance.new("ImageButton")
    closeButton.Size = UDim2.new(0, 24, 0, 24)
    closeButton.Position = UDim2.new(1, -30, 0.5, -12)
    closeButton.Image = Sky.Icons.Close or "rbxassetid://10734872306"
    closeButton.BackgroundTransparency = 1
    closeButton.ZIndex = 12
    closeButton.Parent = titleBar
    
    closeButton.MouseButton1Click:Connect(function()
        windowFrame.Visible = false
        Sky.Toggled = false
    end)
    
    -- 标签栏
    local tabContainer = Instance.new("Frame")
    tabContainer.Size = UDim2.new(1, -20, 0, 35)
    tabContainer.Position = UDim2.new(0, 10, 0, 45)
    tabContainer.BackgroundTransparency = 1
    tabContainer.Parent = windowFrame
    tabContainer.ZIndex = 11
    
    local tabList = Instance.new("ScrollingFrame")
    tabList.Size = UDim2.new(1, 0, 1, 0)
    tabList.BackgroundTransparency = 1
    tabList.ScrollBarThickness = 0
    tabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabList.Parent = tabContainer
    
    local tabLayout = Instance.new("UIListLayout")
    tabLayout.FillDirection = Enum.FillDirection.Horizontal
    tabLayout.Padding = UDim.new(0, 5)
    tabLayout.Parent = tabList
    
    -- 内容区域
    local contentFrame = Sky.CreateRoundedFrame(windowFrame, UDim2.new(1, -20, 1, -90), 
                                              UDim2.new(0, 10, 0, 85), 8, nil, 0.2)
    contentFrame.ZIndex = 10
    
    local contentScroller = Instance.new("ScrollingFrame")
    contentScroller.Size = UDim2.new(1, 0, 1, 0)
    contentScroller.BackgroundTransparency = 1
    contentScroller.ScrollBarThickness = 6
    contentScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
    contentScroller.Parent = contentFrame
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 10)
    contentLayout.Parent = contentScroller
    
    function window.AddTab(name)
        local tab = {
            Elements = {}
        }
        
        local tabButton = Sky.CreateButton(tabList, name, UDim2.new(0, 100, 1, 0), UDim2.new(0, 0, 0, 0))
        tabButton.BackgroundTransparency = 0.7
        tabButton.ZIndex = 12
        
        local function showTab()
            for _, element in pairs(tab.Elements) do
                if element.Holder then
                    element.Holder.Visible = true
                end
            end
            tabButton.BackgroundTransparency = 0.2
        end
        
        local function hideTab()
            for _, element in pairs(tab.Elements) do
                if element.Holder then
                    element.Holder.Visible = false
                end
            end
            tabButton.BackgroundTransparency = 0.7
        end
        
        tabButton.MouseButton1Click:Connect(function()
            for _, otherTab in pairs(window.Tabs) do
                if otherTab ~= tab then
                    otherTab.Hide()
                end
            end
            showTab()
        end)
        
        -- 元素容器
        local tabContent = Instance.new("Frame")
        tabContent.Size = UDim2.new(1, 0, 0, 0)
        tabContent.BackgroundTransparency = 1
        tabContent.Parent = contentScroller
        tabContent.Visible = false
        tabContent.ZIndex = 11
        
        local tabContentLayout = Instance.new("UIListLayout")
        tabContentLayout.Padding = UDim.new(0, 10)
        tabContentLayout.Parent = tabContent
        
        function tab.AddElement(elementType, ...)
            local element
            local elementFrame = Instance.new("Frame")
            elementFrame.Size = UDim2.new(1, 0, 0, 0)
            elementFrame.BackgroundTransparency = 1
            elementFrame.Parent = tabContent
            elementFrame.ZIndex = 11
            
            if elementType == "Toggle" then
                element = Sky.CreateToggle(elementFrame, ...)
            elseif elementType == "Slider" then
                element = Sky.CreateSlider(elementFrame, ...)
            elseif elementType == "Button" then
                element = Sky.CreateButton(elementFrame, ...)
            elseif elementType == "Dropdown" then
                element = Sky.CreateDropdown(elementFrame, ...)
            elseif elementType == "Label" then
                element = Sky.CreateLabel(elementFrame, ...)
            end
            
            element.Holder = elementFrame
            tab.Elements[#tab.Elements + 1] = element
            return element
        end
        
        window.Tabs[name] = tab
        hideTab()
        
        -- 更新标签栏大小
        local function updateTabListSize()
            local totalWidth = 0
            for _, child in ipairs(tabList:GetChildren()) do
                if child:IsA("GuiObject") then
                    totalWidth += child.AbsoluteSize.X + 5
                end
            end
            tabList.CanvasSize = UDim2.new(0, totalWidth, 0, 0)
        end
        
        updateTabListSize()
        tabList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateTabListSize)
        
        return tab
    end
    
    -- 窗口拖拽
    local drag = {
        Dragging = false,
        StartPosition = Vector2.new(0, 0),
        StartOffset = Vector2.new(0, 0)
    }
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            drag.Dragging = true
            drag.StartPosition = input.Position
            drag.StartOffset = Vector2.new(windowFrame.Position.X.Offset, windowFrame.Position.Y.Offset)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if drag.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - drag.StartPosition
            windowFrame.Position = UDim2.new(0, drag.StartOffset.X + delta.X, 0, drag.StartOffset.Y + delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            drag.Dragging = false
        end
    end)
    
    -- 窗口大小调整
    local resizeHandle = Instance.new("Frame")
    resizeHandle.Size = UDim2.new(0, 20, 0, 20)
    resizeHandle.Position = UDim2.new(1, -20, 1, -20)
    resizeHandle.BackgroundTransparency = 1
    resizeHandle.Parent = windowFrame
    resizeHandle.ZIndex = 11
    
    local resizeIcon = Instance.new("ImageLabel")
    resizeIcon.Size = UDim2.new(1, 0, 1, 0)
    resizeIcon.Image = "rbxassetid://10734909078" -- 调整大小图标
    resizeIcon.BackgroundTransparency = 1
    resizeIcon.Parent = resizeHandle
    
    local resizing = false
    local startSize = Vector2.new(0, 0)
    local startPosition = Vector2.new(0, 0)
    
    resizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = true
            startSize = Vector2.new(windowFrame.AbsoluteSize.X, windowFrame.AbsoluteSize.Y)
            startPosition = input.Position
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if resizing and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - startPosition
            local newSize = Vector2.new(
                math.max(Sky.MinSize.X, startSize.X + delta.X),
                math.max(Sky.MinSize.Y, startSize.Y + delta.Y)
            )
            windowFrame.Size = UDim2.new(0, newSize.X, 0, newSize.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = false
        end
    end)
    
    -- 添加到窗口列表
    Sky.Windows[title] = window
    window.Frame = windowFrame
    window.Position = position
    window.Size = size
    
    -- 快捷键显示/隐藏窗口
    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.RightControl then
            Sky.Toggled = not Sky.Toggled
            windowFrame.Visible = Sky.Toggled
        end
    end)
    
    return window
end

-- 初始化
Sky.InitIcons()
local quickMenu = Sky.CreateQuickMenu()

-- 添加示例配置项
quickMenu.AddButton("保存配置", Sky.Icons.Save, function()
    Sky.SaveConfig()
    Sky.Notify("配置已保存", "当前配置已成功保存", 3, Sky.Icons.Check)
end)

quickMenu.AddButton("加载配置", Sky.Icons.Load, function()
    if Sky.LoadConfig() then
        Sky.Notify("配置已加载", "配置已成功加载到界面", 3, Sky.Icons.Check)
    else
        Sky.Notify("加载失败", "找不到有效的配置", 3, Sky.Icons.Error)
    end
end)

quickMenu.AddButton("重置界面", "rbxassetid://10734910021", function()
    Sky.Notify("界面已重置", "所有设置已恢复默认值", 3, Sky.Icons.Check)
end)

quickMenu.AddSeparator()

quickMenu.AddButton("设置", Sky.Icons.Settings, function()
    Sky.Notify("设置", "打开设置面板", 2, Sky.Icons.Settings)
end)

quickMenu.AddButton("退出", Sky.Icons.Close, function()
    Sky.Notify("退出", "正在关闭界面", 2, Sky.Icons.Close)
    wait(0.5)
    for _, window in pairs(Sky.Windows) do
        window.Frame.Visible = false
    end
    Sky.Toggled = false
end)

-- 创建示例窗口
local mainWindow = Sky.CreateWindow("Sky UI 控制面板", UDim2.new(0, 500, 0, 500), UDim2.new(0.5, -250, 0.5, -250))

local generalTab = mainWindow.AddTab("常规设置")
generalTab.AddElement("Label", "界面主题设置", UDim2.new(1, 0, 0, 30), UDim2.new(0, 0, 0, 0))

local themeDropdown = generalTab.AddElement("Dropdown", "主题", {"Dark", "Light", "Blue", "Green"}, "Dark", function(theme)
    Sky.Theme = theme
    Sky.Notify("主题已更改", "已切换到 " .. theme .. " 主题", 2, Sky.Icons.Settings)
end)

local transparencySlider = generalTab.AddElement("Slider", "透明度", 0, 100, 20, function(value)
    Sky.Transparency = value / 100
    Sky.Notify("透明度已调整", "当前透明度: " .. value .. "%", 2)
end)

local featuresTab = mainWindow.AddTab("功能设置")
featuresTab.AddElement("Label", "启用/禁用功能", UDim2.new(1, 0, 0, 30), UDim2.new(0, 0, 0, 0))

local espToggle = featuresTab.AddElement("Toggle", "显示玩家ESP", false, function(state)
    Sky.Notify("ESP " .. (state and "启用" or "禁用"), "玩家ESP功能已" .. (state and "启用" or "禁用"), 2)
end)

local aimbotToggle = featuresTab.AddElement("Toggle", "启用自瞄", false, function(state)
    Sky.Notify("自瞄 " .. (state and "启用" or "禁用"), "自瞄功能已" .. (state and "启用" or "禁用"), 2)
end)

local configTab = mainWindow.AddTab("配置管理")
configTab.AddElement("Label", "配置管理", UDim2.new(1, 0, 0, 30), UDim2.new(0, 0, 0, 0))

configTab.AddElement("Button", "保存当前配置", UDim2.new(1, -20, 0, 35), UDim2.new(0, 10, 0, 40), function()
    Sky.SaveConfig()
    Sky.Notify("配置已保存", "当前配置已成功保存", 3, Sky.Icons.Check)
end)

configTab.AddElement("Button", "加载默认配置", UDim2.new(1, -20, 0, 35), UDim2.new(0, 10, 0, 85), function()
    if Sky.LoadConfig("default") then
        Sky.Notify("配置已加载", "默认配置已成功加载", 3, Sky.Icons.Check)
    end
end)

configTab.AddElement("Button", "创建新配置", UDim2.new(1, -20, 0, 35), UDim2.new(0, 10, 0, 130), function()
    Sky.Notify("新配置", "创建新配置", 2, Sky.Icons.Settings)
end)

-- 初始通知
Sky.Notify("Sky UI 已加载", "按 RightControl 键显示/隐藏界面", 5, Sky.Icons.Menu)

return Sky